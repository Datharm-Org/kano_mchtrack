<?xml version="1.0"?>
<h:html xmlns="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:h="http://www.w3.org/1999/xhtml" xmlns:jr="http://openrosa.org/javarosa" xmlns:orx="http://openrosa.org/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <h:head>
    <h:title>Facility Feedback</h:title>
    <model>
      <itext>
        <translation lang="en">
          <text id="static_instance-care_given-0">
            <value>Immunization</value>
          </text>
          <text id="static_instance-care_given-1">
            <value>ANC</value>
          </text>
          <text id="static_instance-care_given-2">
            <value>PNC</value>
          </text>
          <text id="static_instance-care_given-3">
            <value>Others</value>
          </text>
          <text id="static_instance-diagnosis-0">
            <value>Malaria</value>
          </text>
          <text id="static_instance-diagnosis-1">
            <value>Diarrhea</value>
          </text>
          <text id="static_instance-diagnosis-2">
            <value>Severe Acute Malnutrition</value>
          </text>
          <text id="static_instance-follow_up-0">
            <value>Yes</value>
          </text>
          <text id="static_instance-immunization_information_source-0">
            <value>Other written record (card or book)</value>
          </text>
          <text id="static_instance-immunization_information_source-1">
            <value>Caregivers recalls</value>
          </text>
          <text id="static_instance-vaccines-0">
            <value>BCG</value>
          </text>
          <text id="static_instance-vaccines-1">
            <value>Hep B 0</value>
          </text>
          <text id="static_instance-vaccines-10">
            <value>OPV 2</value>
          </text>
          <text id="static_instance-vaccines-11">
            <value>Rota 2</value>
          </text>
          <text id="static_instance-vaccines-12">
            <value>Penta 3</value>
          </text>
          <text id="static_instance-vaccines-13">
            <value>PCV 3</value>
          </text>
          <text id="static_instance-vaccines-14">
            <value>Rota 3</value>
          </text>
          <text id="static_instance-vaccines-15">
            <value>OPV 3</value>
          </text>
          <text id="static_instance-vaccines-16">
            <value>IPV 2</value>
          </text>
          <text id="static_instance-vaccines-17">
            <value>Vitamin A 1st dose</value>
          </text>
          <text id="static_instance-vaccines-18">
            <value>Measles 1st dose</value>
          </text>
          <text id="static_instance-vaccines-19">
            <value>Yellow fever</value>
          </text>
          <text id="static_instance-vaccines-2">
            <value>OPV 0</value>
          </text>
          <text id="static_instance-vaccines-20">
            <value>Meningitis</value>
          </text>
          <text id="static_instance-vaccines-21">
            <value>Vitamin A 2nd dose</value>
          </text>
          <text id="static_instance-vaccines-22">
            <value>Measles 2nd dose</value>
          </text>
          <text id="static_instance-vaccines-23">
            <value>HPV</value>
          </text>
          <text id="static_instance-vaccines-3">
            <value>Penta 1</value>
          </text>
          <text id="static_instance-vaccines-4">
            <value>PCV 1</value>
          </text>
          <text id="static_instance-vaccines-5">
            <value>OPV 1</value>
          </text>
          <text id="static_instance-vaccines-6">
            <value>Rota 1</value>
          </text>
          <text id="static_instance-vaccines-7">
            <value>IPV 1</value>
          </text>
          <text id="static_instance-vaccines-8">
            <value>Penta 2</value>
          </text>
          <text id="static_instance-vaccines-9">
            <value>PCV 2</value>
          </text>
          <text id="static_instance-yes_no-0">
            <value>Yes</value>
          </text>
          <text id="static_instance-yes_no-1">
            <value>No</value>
          </text>
        </translation>
      </itext>
      <instance>
        <r delimiter="#" id="client_visit" prefix="J1!client_visit!" version="2017-09-30 00:00:00">
          <inputs>
            <meta>
              <location>
                <lat/>
                <long/>
                <error/>
                <message/>
              </location>
            </meta>
            <source>user</source>
            <source_id/>
            <contact>
              <_id/>
              <name/>
              <phone/>
            </contact>
            <user>
              <contact_id/>
              <facility_id/>
              <name/>
            </user>
          </inputs>
          <rapidpro_uuid tag="hidden"/>
          <phone/>
          <patient_id tag="hidden"/>
          <r_visit_comments/>
          <r_immunization>
            <r_previous_dose/>
            <r_previous_vaccines/>
            <r_is_zero_dose_child/>
            <r_vaccines_administered/>
            <r_next_immunization_date/>
            <r_next_immunization_vaccines/>
          </r_immunization>
          <r_routine>
            <r_diagnosis/>
          </r_routine>
          <r_next_appointment/>
          <form tag="hidden">
            <visit_date>today()</visit_date>
            <tracks/>
            <immunization>
              <history>
                <previous_vaccines/>
                <previous_dose/>
                <immunization_information_source/>
                <previous_vaccines_off_record/>
                <is_zero_dose/>
              </history>
              <current_scheduled_vac/>
              <vaccines_administered/>
              <next_session>
                <hidden_vacc_sch/>
                <next_vacc_schedule/>
                <next_immunization_vaccines/>
              </next_session>
            </immunization>
            <anc>
              <edd/>
            </anc>
            <pnc>
              <dd/>
            </pnc>
            <routine>
              <diagnosis/>
            </routine>
            <appointments>
              <has_next_appointment/>
              <current_schedule/>
              <change_appointment/>
              <new_date>today()</new_date>
            </appointments>
            <comments/>
          </form>
          <meta tag="hidden">
            <instanceID/>
          </meta>
        </r>
      </instance>
      <instance id="contact-summary"/>
      <instance id="follow_up">
        <root>
          <item>
            <itextId>static_instance-follow_up-0</itextId>
            <name>yes</name>
          </item>
        </root>
      </instance>
      <instance id="immunization_information_source">
        <root>
          <item>
            <itextId>static_instance-immunization_information_source-0</itextId>
            <name>other_written_record</name>
          </item>
          <item>
            <itextId>static_instance-immunization_information_source-1</itextId>
            <name>mother_recalls</name>
          </item>
        </root>
      </instance>
      <instance id="vaccines">
        <root>
          <item>
            <itextId>static_instance-vaccines-0</itextId>
            <filter>BCG</filter>
            <name>BCG</name>
            <district>0</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-1</itextId>
            <filter>HepB_0</filter>
            <name>HepB_0</name>
            <district>0</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-2</itextId>
            <filter>OPV_0</filter>
            <name>OPV_0</name>
            <district>0</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-3</itextId>
            <filter>Penta_1</filter>
            <name>Penta_1</name>
            <district>6</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-4</itextId>
            <filter>PCV_1</filter>
            <name>PCV_1</name>
            <district>6</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-5</itextId>
            <filter>OPV_1</filter>
            <name>OPV_1</name>
            <district>6</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-6</itextId>
            <filter>Rota_1</filter>
            <name>Rota_1</name>
            <district>6</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-7</itextId>
            <filter>IPV_1</filter>
            <name>IPV_1</name>
            <district>6</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-8</itextId>
            <filter>Penta_2</filter>
            <name>Penta_2</name>
            <district>10</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-9</itextId>
            <filter>PCV_2</filter>
            <name>PCV_2</name>
            <district>10</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-10</itextId>
            <filter>OPV_2</filter>
            <name>OPV_2</name>
            <district>10</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-11</itextId>
            <filter>Rota_2</filter>
            <name>Rota_2</name>
            <district>10</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-12</itextId>
            <filter>Penta_3</filter>
            <name>Penta_3</name>
            <district>14</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-13</itextId>
            <filter>PCV_3</filter>
            <name>PCV_3</name>
            <district>14</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-14</itextId>
            <filter>Rota_3</filter>
            <name>Rota_3</name>
            <district>14</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-15</itextId>
            <filter>OPV_3</filter>
            <name>OPV_3</name>
            <district>14</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-16</itextId>
            <filter>IPV_2</filter>
            <name>IPV_2</name>
            <district>14</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-17</itextId>
            <filter>VitaminA_1</filter>
            <name>VitaminA_1</name>
            <district>6</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-18</itextId>
            <filter>Measles_1</filter>
            <name>Measles_1</name>
            <district>36</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-19</itextId>
            <filter>YF</filter>
            <name>YF</name>
            <district>36</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-20</itextId>
            <filter>meningitis</filter>
            <name>meningitis</name>
            <district>36</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-21</itextId>
            <filter>VitaminA_2</filter>
            <name>VitaminA_2</name>
            <district>48</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-22</itextId>
            <filter>Measles_2</filter>
            <name>Measles_2</name>
            <district>72</district>
          </item>
          <item>
            <itextId>static_instance-vaccines-23</itextId>
            <filter>HPV</filter>
            <name>HPV</name>
            <district>332</district>
          </item>
        </root>
      </instance>
      <instance id="diagnosis">
        <root>
          <item>
            <itextId>static_instance-diagnosis-0</itextId>
            <name>malaria</name>
          </item>
          <item>
            <itextId>static_instance-diagnosis-1</itextId>
            <name>diarrhea</name>
          </item>
          <item>
            <itextId>static_instance-diagnosis-2</itextId>
            <name>severe_acute_malnutrition</name>
          </item>
        </root>
      </instance>
      <instance id="care_given">
        <root>
          <item>
            <itextId>static_instance-care_given-0</itextId>
            <filter>child</filter>
            <name>immunization</name>
          </item>
          <item>
            <itextId>static_instance-care_given-1</itextId>
            <filter>woman</filter>
            <name>anc</name>
          </item>
          <item>
            <itextId>static_instance-care_given-2</itextId>
            <filter>woman</filter>
            <name>pnc</name>
          </item>
          <item>
            <itextId>static_instance-care_given-3</itextId>
            <filter>both</filter>
            <name>others</name>
          </item>
        </root>
      </instance>
      <instance id="yes_no">
        <root>
          <item>
            <itextId>static_instance-yes_no-0</itextId>
            <name>yes</name>
          </item>
          <item>
            <itextId>static_instance-yes_no-1</itextId>
            <name>no</name>
          </item>
        </root>
      </instance>
      <bind nodeset="/r/inputs" relevant="./source = 'user'"/>
      <bind nodeset="/r/inputs/source" type="string"/>
      <bind nodeset="/r/inputs/source_id" type="string"/>
      <bind nodeset="/r/inputs/contact/_id" required="true()" type="db:person"/>
      <bind nodeset="/r/inputs/contact/name" type="string"/>
      <bind nodeset="/r/inputs/contact/phone" type="string"/>
      <bind nodeset="/r/inputs/user/contact_id" type="string"/>
      <bind nodeset="/r/inputs/user/facility_id" type="string"/>
      <bind nodeset="/r/inputs/user/name" type="string"/>
      <bind calculate="instance('contact-summary')/context/rapidpro_uuid" nodeset="/r/rapidpro_uuid" type="string"/>
      <bind calculate="../inputs/contact/phone" nodeset="/r/phone" type="string"/>
      <bind calculate="../inputs/contact/_id" nodeset="/r/patient_id" required="true()" type="string"/>
      <bind calculate="../form/comments" nodeset="/r/r_visit_comments" type="string"/>
      <bind nodeset="/r/r_immunization" relevant="selected( /r/form/tracks , 'immunization')"/>
      <bind calculate="../../form/immunization/history/previous_dose" nodeset="/r/r_immunization/r_previous_dose" type="string"/>
      <bind calculate="../../form/immunization/history/previous_vaccines" nodeset="/r/r_immunization/r_previous_vaccines" type="string"/>
      <bind calculate="../../form/immunization/history/is_zero_dose" nodeset="/r/r_immunization/r_is_zero_dose_child" relevant="selected( /r/form/immunization/history/previous_dose , 'no') and string-length( /r/form/immunization/history/previous_vaccines ) = 0" type="string"/>
      <bind calculate="../../form/immunization/vaccines_administered" nodeset="/r/r_immunization/r_vaccines_administered" type="string"/>
      <bind calculate="../../form/appointments/new_date" nodeset="/r/r_immunization/r_next_immunization_date" type="string"/>
      <bind calculate="../../form/immunization/next_session/next_immunization_vaccines" nodeset="/r/r_immunization/r_next_immunization_vaccines" type="string"/>
      <bind nodeset="/r/r_routine" relevant="selected( /r/form/tracks , 'others')"/>
      <bind calculate="../../form/routine/diagnosis" nodeset="/r/r_routine/r_diagnosis" type="string"/>
      <bind calculate="../form/appointments/new_date" nodeset="/r/r_next_appointment" type="string"/>
      <bind constraint=". &lt;= today()" jr:constraintMsg="Please select current or previous date" nodeset="/r/form/visit_date" required="true()" type="date"/>
      <bind nodeset="/r/form/tracks" type="select"/>
      <bind nodeset="/r/form/immunization" relevant="contains( /r/form/tracks , 'immunization')"/>
      <bind calculate="translate(instance('contact-summary')/context/vaccines_taken, ',', ' ')" nodeset="/r/form/immunization/history/previous_vaccines" readonly="true()" type="string"/>
      <bind nodeset="/r/form/immunization/history/previous_dose" type="select1"/>
      <bind nodeset="/r/form/immunization/history/immunization_information_source" relevant="selected( /r/form/immunization/history/previous_dose , 'yes')" required="true()" type="select1"/>
      <bind nodeset="/r/form/immunization/history/previous_vaccines_off_record" relevant="selected( /r/form/immunization/history/previous_dose , 'yes')" required="true()" type="select"/>
      <bind nodeset="/r/form/immunization/history/is_zero_dose" relevant="selected( /r/form/immunization/history/previous_dose , 'no') and string-length( /r/form/immunization/history/previous_vaccines ) = 0" type="select1"/>
      <bind calculate="instance('contact-summary')/context/next_immunizations" nodeset="/r/form/immunization/current_scheduled_vac" type="string"/>
      <bind nodeset="/r/form/immunization/vaccines_administered" required="true()" type="select"/>
      <bind calculate="instance('contact-summary')/context/vac_after_next" nodeset="/r/form/immunization/next_session/hidden_vacc_sch" type="string"/>
      <bind nodeset="/r/form/immunization/next_session/next_vacc_schedule" readonly="true()" type="string"/>
      <bind nodeset="/r/form/immunization/next_session/next_immunization_vaccines" type="select"/>
      <bind nodeset="/r/form/anc" relevant="contains( /r/form/tracks , 'anc')"/>
      <bind nodeset="/r/form/anc/edd" type="date"/>
      <bind nodeset="/r/form/pnc" relevant="contains( /r/form/tracks , 'pnc')"/>
      <bind nodeset="/r/form/pnc/dd" type="date"/>
      <bind nodeset="/r/form/routine" relevant="contains( /r/form/tracks , 'others')"/>
      <bind nodeset="/r/form/routine/diagnosis" required="true()" type="select1"/>
      <bind nodeset="/r/form/appointments/has_next_appointment" type="select1"/>
      <bind calculate="instance('contact-summary')/context/next_appointment" nodeset="/r/form/appointments/current_schedule" readonly="true()" relevant="selected( /r/form/appointments/has_next_appointment , 'yes')" type="string"/>
      <bind nodeset="/r/form/appointments/change_appointment" relevant="selected( /r/form/appointments/has_next_appointment , 'yes')" type="select1"/>
      <bind nodeset="/r/form/appointments/new_date" relevant="selected( /r/form/appointments/has_next_appointment , 'yes') and selected( /r/form/appointments/change_appointment , 'yes')" required="true()" type="date"/>
      <bind nodeset="/r/form/comments" type="string"/>
      <bind calculate="concat('uuid:', uuid())" nodeset="/r/meta/instanceID" readonly="true()" type="string"/>
    </model>
  </h:head>
  <h:body class="pages">
    <group appearance="field-list" ref="/r/inputs">
      <label></label>
      <input appearance="hidden" ref="/r/inputs/source">
        <label>Source</label>
      </input>
      <input appearance="hidden" ref="/r/inputs/source_id">
        <label>Source ID</label>
      </input>
      <group ref="/r/inputs/contact">
        <label>Contact</label>
        <input appearance="db-object" ref="/r/inputs/contact/_id">
          <label>What is the patient's name?</label>
          <hint>Select a person from list</hint>
        </input>
      </group>
      <group appearance="hidden" ref="/r/inputs/user">
        <label></label>
        <input appearance="hidden" ref="/r/inputs/user/contact_id">
          <label></label>
        </input>
        <input appearance="hidden" ref="/r/inputs/user/facility_id">
          <label></label>
        </input>
        <input appearance="hidden" ref="/r/inputs/user/name">
          <label></label>
        </input>
      </group>
    </group>
    <group appearance="hidden" ref="/r/r_immunization"/>
    <group ref="/r/r_routine"/>
    <group ref="/r/form">
      <label>This information about in-person clinic visits that should be an Action Form in the client Profile.</label>
      <input ref="/r/form/visit_date">
        <label>Date of visit</label>
      </input>
      <select ref="/r/form/tracks">
        <label>Care given</label>
        <itemset nodeset="instance('care_given')/root/item[instance('contact-summary')/context/client_type = filter or filter = 'both']">
          <value ref="name"/>
          <label ref="jr:itext(itextId)"/>
        </itemset>
      </select>
      <group ref="/r/form/immunization">
        <label></label>
        <group appearance="field-list" ref="/r/form/immunization/history">
          <label></label>
          <input ref="/r/form/immunization/history/previous_vaccines">
            <label>&lt;h3&gt;Previous vaccines taken on record&lt;/h3&gt;</label>
          </input>
          <select1 ref="/r/form/immunization/history/previous_dose">
            <label>Has child taken previous vaccines off record</label>
            <hint>Only if child has taken vaccines not captured on the previous list</hint>
            <item>
              <label>Yes</label>
              <value>yes</value>
            </item>
            <item>
              <label>No</label>
              <value>no</value>
            </item>
          </select1>
          <select1 ref="/r/form/immunization/history/immunization_information_source">
            <label>Indicate the source of the previous information</label>
            <item>
              <label>Other written record (card or book)</label>
              <value>other_written_record</value>
            </item>
            <item>
              <label>Caregivers recalls</label>
              <value>mother_recalls</value>
            </item>
          </select1>
          <select appearance="search('vaccines')" ref="/r/form/immunization/history/previous_vaccines_off_record">
            <label>Previous vaccines taken off record</label>
            <itemset nodeset="instance('vaccines')/root/item[not(contains( /r/form/immunization/history/previous_vaccines , filter))]">
              <value ref="name"/>
              <label ref="jr:itext(itextId)"/>
            </itemset>
          </select>
          <select1 ref="/r/form/immunization/history/is_zero_dose">
            <label>Zero dose child</label>
            <hint>Child has never taken any vaccines before</hint>
            <item>
              <label>Yes</label>
              <value>yes</value>
            </item>
            <item>
              <label>No</label>
              <value>no</value>
            </item>
          </select1>
        </group>
        <select appearance="search('vaccines')" ref="/r/form/immunization/vaccines_administered">
          <label>Vaccines administered this session (<output value=" /r/form/immunization/current_scheduled_vac "/>)</label>
          <itemset nodeset="instance('vaccines')/root/item[not(contains(concat( /r/form/immunization/history/previous_vaccines ,  /r/form/immunization/history/previous_vaccines_off_record ), filter))]">
            <value ref="name"/>
            <label ref="jr:itext(itextId)"/>
          </itemset>
        </select>
        <group appearance="field-list" ref="/r/form/immunization/next_session">
          <label>Vaccines to be administered on next visit</label>
          <input ref="/r/form/immunization/next_session/next_vacc_schedule">
            <label><output value=" /r/form/immunization/next_session/hidden_vacc_sch "/></label>
          </input>
          <select appearance="search('vaccines')" ref="/r/form/immunization/next_session/next_immunization_vaccines">
            <itemset nodeset="instance('vaccines')/root/item[not(contains(concat( /r/form/immunization/history/previous_vaccines ,  /r/form/immunization/history/previous_vaccines_off_record ,  /r/form/immunization/vaccines_administered ), filter))]">
              <value ref="name"/>
              <label ref="jr:itext(itextId)"/>
            </itemset>
          </select>
        </group>
      </group>
      <group appearance="field-list" ref="/r/form/anc">
        <label></label>
        <input ref="/r/form/anc/edd">
          <label>Expected delivery date</label>
        </input>
      </group>
      <group appearance="field-list" ref="/r/form/pnc">
        <label></label>
        <input ref="/r/form/pnc/dd">
          <label>Delivery Date</label>
        </input>
      </group>
      <group appearance="field-list" ref="/r/form/routine">
        <select1 ref="/r/form/routine/diagnosis">
          <label>Diagnosis given</label>
          <item>
            <label>Malaria</label>
            <value>malaria</value>
          </item>
          <item>
            <label>Diarrhea</label>
            <value>diarrhea</value>
          </item>
          <item>
            <label>Severe Acute Malnutrition</label>
            <value>severe_acute_malnutrition</value>
          </item>
        </select1>
      </group>
      <group appearance="field-list" ref="/r/form/appointments">
        <label>Appointments</label>
        <select1 ref="/r/form/appointments/has_next_appointment">
          <label>Client requires another appointment</label>
          <item>
            <label>Yes</label>
            <value>yes</value>
          </item>
          <item>
            <label>No</label>
            <value>no</value>
          </item>
        </select1>
        <input ref="/r/form/appointments/current_schedule">
          <label>Current Schedule</label>
        </input>
        <select1 ref="/r/form/appointments/change_appointment">
          <label>Change appointment date</label>
          <item>
            <label>Yes</label>
            <value>yes</value>
          </item>
          <item>
            <label>No</label>
            <value>no</value>
          </item>
        </select1>
        <input ref="/r/form/appointments/new_date">
          <label>New appointment date</label>
        </input>
      </group>
      <input appearance="multiline" ref="/r/form/comments">
        <label>Comments</label>
      </input>
    </group>
  </h:body>
</h:html>
